# Practice_NoSQLInjection

## Краткое описание уязвимости
NoSQL Injection - уязвимость, которая позволяет злоумышленнику создавать запросы к noSQL базам данных, не предусмотренные разработчиком.
Возникает она из-за неправильной обработки данных, которые впоследствие присутствуют в запросе к базе данных.
Данный сервис позволяет получить все штрафы пользователя по имени человека.

## Способы защиты от уязвимости
- Корректная обработка и экранирование входных данных.
- Настройка прав доступа к базе данных.
- Использование параметризированных запросов.
- Использование ORM/ODM

## Запуск приложения
Для запуска приложения нужно:
1. Склонировать репозиторий:
```bash
git clone https://github.com/MinaevMax/Practice_NoSQLInjection.git
cd Practice_NoSQLInjection
```
2. Запуск приложения через docker-compose:
```bash
docker-compose up --build
```
3. Приложение будет запущено по адресу: [http://localhost:8080](http://localhost:8080)

## Описание уязвимости конкретно в данном приложении
Сервис позволяет получить флаг, находящийся в поле name у пользователя, имеющего роль admin.
Есть хэндлер, который возвращает из бд поля: id штрафа, имя на кого он выписан, какая роль у оштрафованного пользователя и размер штрафа.
Есть вспомогательные эндпоинты, позволяющие добавить запись штрафа и посмотреть количество штрафов и пользователей в базе данных.
Для того, чтобы получить флаг, нужно передать вместо имени запрос, который позволяет получить данные о пользователе у нужной записи.

## POC-эксплоит для получения флага
Для получения флага, необходимо получить все записи, располагающиеся в базе данных, и найти на странице с помощью встроенного в браузер функционала запись с ролью admin.

Для начала проверим доступный нам функционал. Увидим, что мы можем запрашивать все штрафы пользователя по имени, добавлять штраф и проверять количество записей. В запросе параметр name имеет вид name=<имя из формы>. Значит, скорее всего запрос к бд выполняется через оператор равенства. Попробуем произвести иньекцию, которая выведет нам все штрафы из базы: ```' || this.name != '```. Тогда запрос к бд с помощью JS будет выглядеть так: ```$where:this.name === '' || this.name != ''```
Из полученных данных находим с помощью сочетания Ctrl+F словосочетание "with role 'admin'". Имя в этом штрафе и будет являться флагом.
Выполнение запросов лучше и удобнее всего проводить через любой удобный для Вас браузер.